<table class="ngx-pivot-table">
    <thead>
        <tr class="ngx-pivot-row ngx-pivot-row--header">
            <ng-container *ngFor="let column of columns; trackBy: trackColumnByFn">
                <th *ngIf="column.isActive" class="ngx-pivot-header-cell" [ngClass]="column.headerClass">
                    <div class="ngx-pivot-header-cell__content">
                        {{ column.header }}
                    </div>
                </th>
            </ng-container>
        </tr>
    </thead>
    <tbody>
        <ng-container *ngFor="let node of nodes">
            <ng-container *ngTemplateOutlet="nodeTemplate; context: { node: node, level: 0 }"></ng-container>
        </ng-container>
    </tbody>
    <tfoot>
        <tr class="ngx-pivot-row ngx-pivot-row--footer">
            <ng-container *ngFor="let column of columns; trackBy: trackColumnByFn">
                <td *ngIf="column.isActive" class="ngx-pivot-footer-cell" [ngClass]="column.footerClass">
                    <div *ngIf="column.footerCalcType" class="ngx-pivot-header-cell__content">
                        {{ data | calculate:column.key:column.footerCalcType | format:column.formatFn }}
                    </div>
                </td>
            </ng-container>
        </tr>
    </tfoot>
</table>

<ng-template #nodeTemplate let-node="node" let-level="level">
    <tr class="ngx-pivot-row ngx-pivot-row--data" (click)="onToggleNodeClick($event, node)">
        <ng-container *ngFor="let column of columns; trackBy: trackColumnByFn; let cIndex = index">
            <td *ngIf="column.isActive" class="ngx-pivot-cell" [ngClass]="column.cellClass"
                [class.ngx-pivot-cell--node]="cIndex === level && (node.nodes || []).length">
                <div class="ngx-pivot-cell__content">
                    {{ node.data[column.key] | format:column.formatFn }}
                </div>
            </td>
        </ng-container>
    </tr>
    <ng-container *ngIf="node.isExpanded">
        <ng-container *ngFor="let child of node.nodes">
            <ng-container *ngTemplateOutlet="nodeTemplate; context: { node: child, level: level + 1 }"></ng-container>
        </ng-container>
    </ng-container>
</ng-template>